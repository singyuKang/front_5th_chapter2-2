import{j as t,r as b,c as D,R as A}from"./client-DD4c7S6m.js";const N=({children:e,as:s="h2",className:a=""})=>{const n=s,o=`${a}`;return t.jsx(n,{className:o,children:e})},p=({onClick:e,children:s,variant:a="primary",disabled:n=!1,className:o="",type:d="button",dataTestId:r=""})=>{const c="px-4 py-2 rounded focus:outline-none transition-colors",i={primary:"bg-white text-blue-600 hover:bg-blue-100",secondary:"bg-blue-600 text-white hover:bg-blue-500",danger:"bg-red-500 text-white hover:bg-red-600",success:"bg-green-500 text-white hover:bg-green-600",default:""},l=n?"opacity-50 cursor-not-allowed":"",u=`${c} ${i[a]} ${l} ${o}`;return t.jsx("button",{"data-testid":r,type:d,onClick:e,className:u,disabled:n,children:s})},T=({item:e,appliedDiscount:s,onUpdateQuantity:a,onRemoveFromCart:n})=>t.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:e.product.name}),t.jsx("br",{}),t.jsxs("span",{className:"text-sm text-gray-600",children:[e.product.price,"원 x ",e.quantity,s>0&&t.jsxs("span",{className:"text-green-600 ml-1",children:["(",(s*100).toFixed(0),"% 할인 적용)"]})]})]}),t.jsxs("div",{children:[t.jsx(p,{onClick:()=>a(e.product.id,e.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1.5 rounded mr-1 hover:bg-gray-400",children:"-"}),t.jsx(p,{onClick:()=>a(e.product.id,e.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1.5 mr-1 hover:bg-gray-400",children:"+"}),t.jsx(p,{onClick:()=>n(e.product.id),variant:"danger",className:"px-2 py-1.5",children:"삭제"})]})]}),w=(e,s)=>e.filter(a=>s>=a.quantity).reduce((a,n)=>Math.max(a,n.rate),0),q=(e,s)=>{const a=e.reduce((d,r)=>d+r.product.price*r.quantity,0);let n=e.reduce((d,r)=>{const c=w(r.product.discounts,r.quantity);return d+r.product.price*r.quantity*(1-c)},0);s&&(s.discountType==="amount"?n=Math.max(0,n-s.discountValue):n*=1-s.discountValue/100);const o=a-n;return{totalBeforeDiscount:Math.round(a),totalAfterDiscount:Math.round(n),totalDiscount:Math.round(o)}},F=(e,s,a)=>e.map(n=>{if(n.product.id===s){const o=Math.max(0,Math.min(a,n.product.stock));return o>0?{...n,quantity:o}:null}return n}).filter(n=>n!==null),V=e=>e.reduce((s,a)=>Math.max(s,a.rate),0),I=(e,s=[])=>{const a=s.find(n=>n.product.id===e.id);return e.stock-((a==null?void 0:a.quantity)||0)},$=e=>w(e.product.discounts,e.quantity),E=(e,s)=>e.find(n=>n.product.id===s.id)?e.map(n=>n.product.id===s.id?{...n,quantity:Math.min(n.quantity+1,s.stock)}:n):[...e,{product:s,quantity:1}],M=({cart:e,onUpdateQuantity:s,onRemoveFromCart:a})=>t.jsxs("div",{children:[t.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),t.jsx("div",{className:"space-y-2",children:e.map(n=>t.jsx(T,{item:n,appliedDiscount:$(n),onUpdateQuantity:s,onRemoveFromCart:a},n.product.id))})]}),R=({coupons:e,selectedCoupon:s,onApplyCoupon:a})=>t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"쿠폰 적용"}),t.jsxs("select",{onChange:n=>a(e[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[t.jsx("option",{value:"",children:"쿠폰 선택"}),e.map((n,o)=>t.jsxs("option",{value:o,children:[n.name," -"," ",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`]},n.code))]}),s&&t.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인)"]})]}),L=({totalBeforeDiscount:e,totalAfterDiscount:s,totalDiscount:a})=>t.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[t.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"주문 요약"}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{children:["상품 금액: ",e.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-green-600",children:["할인 금액: ",a.toLocaleString(),"원"]}),t.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",s.toLocaleString(),"원"]})]})]}),U=({product:e,remainingStock:s,onAddToCart:a})=>t.jsxs("div",{"data-testid":`product-${e.id}`,className:"bg-white p-3 rounded shadow",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"font-semibold",children:e.name}),t.jsxs("span",{className:"text-gray-600",children:[e.price.toLocaleString(),"원"]})]}),t.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[t.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),e.discounts.length>0&&t.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(V(e.discounts)*100).toFixed(0),"% 할인"]})]}),e.discounts.length>0&&t.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:e.discounts.map((n,o)=>t.jsxs("li",{children:[n.quantity,"개 이상: ",(n.rate*100).toFixed(0),"% 할인"]},o))}),t.jsx(p,{onClick:()=>a(e),variant:"secondary",className:`w-full px-3 py-1 ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]}),O=({products:e,cart:s,onAddToCart:a})=>t.jsxs("div",{children:[t.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"상품 목록"}),t.jsx("div",{className:"space-y-2",children:e.map(n=>t.jsx(U,{product:n,remainingStock:I(n,s),onAddToCart:a},n.id))})]}),B=()=>{const[e,s]=b.useState([]),[a,n]=b.useState(null);return{cart:e,addToCart:l=>{s(u=>E(u,l))},removeFromCart:l=>{s(u=>u.filter(g=>g.product.id!==l))},updateQuantity:(l,u)=>{s(g=>F(g,l,u))},applyCoupon:l=>{n(l)},calculateTotal:()=>q(e,a),selectedCoupon:a}};function P(e,s){const[a,n]=b.useState(()=>{try{const d=window.localStorage.getItem(e);return d?JSON.parse(d):s}catch{return s}});return[a,d=>{try{const r=d instanceof Function?d(a):d;n(r),window.localStorage.setItem(e,JSON.stringify(r))}catch(r){console.log(r)}}]}const Q=e=>{const[s,a]=P("coupons",e);return{coupons:s,addCoupon:o=>{a(d=>[...d,o])}}},J=e=>{const[s,a]=P("products",e);return{products:s,updateProduct:r=>{a(c=>c.map(i=>i.id===r.id?r:i))},addProduct:r=>{a(c=>[...c,r])},removeProduct:r=>{a(c=>c.filter(i=>i.id!==r))}}},W=({products:e,coupons:s})=>{const{cart:a,addToCart:n,removeFromCart:o,updateQuantity:d,applyCoupon:r,calculateTotal:c,selectedCoupon:i}=B(),{totalBeforeDiscount:l,totalAfterDiscount:u,totalDiscount:g}=c();return t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx(N,{as:"h1",className:"text-3xl font-bold mb-6",children:"장바구니"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(O,{products:e,cart:a,onAddToCart:n}),t.jsxs("div",{children:[t.jsx(M,{cart:a,onUpdateQuantity:d,onRemoveFromCart:o}),t.jsx(R,{coupons:s,selectedCoupon:i,onApplyCoupon:r}),t.jsx(L,{totalBeforeDiscount:l,totalAfterDiscount:u,totalDiscount:g})]})]})]})};function H(e){let s=!0;return e.name.trim()||(s=!1),e.code.trim()||(s=!1),e.discountValue<=0&&(s=!1),s}function _({onAddCoupon:e}){const[s,a]=b.useState({name:"",code:"",discountType:"percentage",discountValue:0});return{newCoupon:s,handleNameChange:i=>{a(l=>({...l,name:i}))},handleCodeChange:i=>{a(l=>({...l,code:i}))},handleDiscountTypeChange:i=>{a(l=>({...l,discountType:i}))},handleDiscountValueChange:i=>{const l=parseInt(i)||0;a(u=>({...u,discountValue:l}))},handleAddCoupon:()=>{H(s)&&(e(s),a({name:"",code:"",discountType:"percentage",discountValue:0}))}}}const z=({onAddCoupon:e})=>{const{newCoupon:s,handleNameChange:a,handleCodeChange:n,handleDiscountTypeChange:o,handleDiscountValueChange:d,handleAddCoupon:r}=_({onAddCoupon:e});return t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:s.name,onChange:c=>a(c.target.value),className:"w-full p-2 border rounded"}),t.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:s.code,onChange:c=>n(c.target.value),className:"w-full p-2 border rounded"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{value:s.discountType,onChange:c=>o(c.target.value),className:"w-full p-2 border rounded",children:[t.jsx("option",{value:"amount",children:"금액(원)"}),t.jsx("option",{value:"percentage",children:"할인율(%)"})]}),t.jsx("input",{type:"number",placeholder:"할인 값",value:s.discountValue,onChange:c=>d(c.target.value),className:"w-full p-2 border rounded"})]}),t.jsx(p,{onClick:r,variant:"success",className:"w-full",children:"쿠폰 추가"})]})},G=({coupon:e,index:s})=>t.jsxs("div",{"data-testid":`coupon-${s+1}`,className:"bg-gray-100 p-2 rounded",children:[e.name," (",e.code,"):",e.discountType==="amount"?`${e.discountValue}원`:`${e.discountValue}%`," ","할인"]}),K=({coupons:e})=>t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),t.jsx("div",{className:"space-y-2",children:e.map((s,a)=>t.jsx(G,{coupon:s,index:a},s.code))})]}),X=({coupons:e,onCouponAdd:s})=>t.jsxs("div",{children:[t.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),t.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[t.jsx(z,{onAddCoupon:s}),t.jsx(K,{coupons:e})]})]}),Y=({newProduct:e,onProductChange:s,onAddProduct:a})=>t.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),t.jsx("input",{id:"productName",type:"text",value:e.name,onChange:n=>s({...e,name:n.target.value}),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),t.jsx("input",{id:"productPrice",type:"number",value:e.price,onChange:n=>s({...e,price:parseInt(n.target.value)}),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-2",children:[t.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),t.jsx("input",{id:"productStock",type:"number",value:e.stock,onChange:n=>s({...e,stock:parseInt(n.target.value)}),className:"w-full p-2 border rounded"})]}),t.jsx(p,{onClick:a,variant:"secondary",className:"w-full",children:"추가"})]}),Z=({discount:e,index:s,onRemove:a,isEditing:n=!1})=>t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[e.quantity,"개 이상 구매 시 ",e.rate*100,"% 할인"]}),n&&a&&t.jsx(p,{onClick:()=>a(s),variant:"default",className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]}),S=({discounts:e,onRemoveDiscount:s,isEditing:a=!1})=>t.jsx(t.Fragment,{children:e.map((n,o)=>t.jsx(Z,{discount:n,index:o,onRemove:s,isEditing:a},o))}),ee=({newDiscount:e,onDiscountChange:s,onAddDiscount:a})=>t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{type:"number",placeholder:"수량",value:e.quantity,onChange:n=>s({...e,quantity:parseInt(n.target.value)}),className:"w-1/3 p-2 border rounded"}),t.jsx("input",{type:"number",placeholder:"할인율 (%)",value:e.rate*100,onChange:n=>s({...e,rate:parseInt(n.target.value)/100}),className:"w-1/3 p-2 border rounded"}),t.jsx(p,{onClick:a,variant:"default",className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]}),te=({product:e,editingProduct:s,newDiscount:a,onProductNameUpdate:n,onPriceUpdate:o,onStockUpdate:d,onDiscountChange:r,onAddDiscount:c,onRemoveDiscount:i,onEditComplete:l})=>t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"상품명: "}),t.jsx("input",{type:"text",value:s.name,onChange:u=>n(e.id,u.target.value),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"가격: "}),t.jsx("input",{type:"number",value:s.price,onChange:u=>o(e.id,parseInt(u.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1",children:"재고: "}),t.jsx("input",{type:"number",value:s.stock,onChange:u=>d(e.id,parseInt(u.target.value)),className:"w-full p-2 border rounded"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),t.jsx(S,{discounts:s.discounts,onRemoveDiscount:u=>i(e.id,u),isEditing:!0}),t.jsx(ee,{newDiscount:a,onDiscountChange:r,onAddDiscount:()=>c(e.id)})]}),t.jsx(p,{onClick:l,variant:"default",className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}),se=({product:e,index:s,isOpen:a,editingProduct:n,newDiscount:o,onToggle:d,onEdit:r,onProductNameUpdate:c,onPriceUpdate:i,onStockUpdate:l,onDiscountChange:u,onAddDiscount:g,onRemoveDiscount:v,onEditComplete:f})=>t.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[t.jsxs(p,{dataTestId:"toggle-button",onClick:()=>d(e.id),variant:"default",className:"w-full text-left font-semibold px-0",children:[e.name," - ",e.price,"원 (재고: ",e.stock,")"]}),a&&t.jsx("div",{className:"mt-2",children:n&&n.id===e.id?t.jsx(te,{product:e,editingProduct:n,newDiscount:o,onProductNameUpdate:c,onPriceUpdate:i,onStockUpdate:l,onDiscountChange:u,onAddDiscount:g,onRemoveDiscount:v,onEditComplete:f}):t.jsxs("div",{children:[t.jsx(S,{discounts:e.discounts}),t.jsx(p,{dataTestId:"modify-button",onClick:()=>r(e),variant:"default",className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]}),ne=({products:e,openProductIds:s,editingProduct:a,newDiscount:n,onToggleProduct:o,onEditProduct:d,onProductNameUpdate:r,onPriceUpdate:c,onStockUpdate:i,onDiscountChange:l,onAddDiscount:u,onRemoveDiscount:g,onEditComplete:v})=>t.jsx("div",{className:"space-y-2",children:e.map((f,y)=>t.jsx(se,{product:f,index:y,isOpen:s.has(f.id),editingProduct:a,newDiscount:n,onToggle:o,onEdit:d,onProductNameUpdate:r,onPriceUpdate:c,onStockUpdate:i,onDiscountChange:l,onAddDiscount:u,onRemoveDiscount:g,onEditComplete:v},f.id))});function ae(e){let s=!0;return e.name.trim()||(s=!1),e.price<=0&&(s=!1),e.stock<=0&&(s=!1),s}function oe({onProductAdd:e}){const[s,a]=b.useState({name:"",price:0,stock:0,discounts:[]}),[n,o]=b.useState(!1);return{newProduct:s,setNewProduct:a,showNewProductForm:n,toggleNewProductForm:()=>{o(!n)},handleAddNewProduct:()=>{if(!ae(s))return;const c={...s,id:Date.now().toString()};return e(c),a({name:"",price:0,stock:0,discounts:[]}),o(!1),c}}}function de(e){let s=!0;return e.quantity<=0&&(s=!1),e.rate<=0&&(s=!1),s}function re({products:e,onProductUpdate:s}){const[a,n]=b.useState(new Set),[o,d]=b.useState(null),[r,c]=b.useState({quantity:0,rate:0});return{openProductIds:a,editingProduct:o,newDiscount:r,setNewDiscount:c,toggleProductAccordion:m=>{n(h=>{const x=new Set(h);return x.has(m)?x.delete(m):x.add(m),x})},handleEditProduct:m=>{d({...m})},handleProductNameUpdate:(m,h)=>{o&&o.id===m&&d({...o,name:h})},handlePriceUpdate:(m,h)=>{o&&o.id===m&&d({...o,price:h})},handleStockUpdate:(m,h)=>{const x=e.find(j=>j.id===m);if(x){const j={...x,stock:h};s(j),d(j)}},handleAddDiscount:m=>{if(de(r)&&o&&o.id===m){const h={...o,discounts:[...o.discounts,r]};s(h),d(h),c({quantity:0,rate:0})}},handleRemoveDiscount:(m,h)=>{const x=e.find(j=>j.id===m);if(x){const j={...x,discounts:x.discounts.filter((pe,k)=>k!==h)};s(j),d(j)}},handleEditComplete:()=>{o&&(s(o),d(null))}}}const ce=({products:e,onProductUpdate:s,onProductAdd:a})=>{const{newProduct:n,setNewProduct:o,showNewProductForm:d,toggleNewProductForm:r,handleAddNewProduct:c}=oe({onProductAdd:a}),{openProductIds:i,editingProduct:l,newDiscount:u,setNewDiscount:g,toggleProductAccordion:v,handleEditProduct:f,handleProductNameUpdate:y,handlePriceUpdate:C,handleStockUpdate:m,handleAddDiscount:h,handleRemoveDiscount:x,handleEditComplete:j}=re({products:e,onProductUpdate:s});return t.jsxs("div",{children:[t.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"상품 관리"}),t.jsx(p,{onClick:r,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:d?"취소":"새 상품 추가"}),d&&t.jsx(Y,{newProduct:n,onProductChange:o,onAddProduct:c}),t.jsx(ne,{products:e,openProductIds:i,editingProduct:l,newDiscount:u,onToggleProduct:v,onEditProduct:f,onProductNameUpdate:y,onPriceUpdate:C,onStockUpdate:m,onDiscountChange:g,onAddDiscount:h,onRemoveDiscount:x,onEditComplete:j})]})},le=({products:e,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:o})=>t.jsxs("div",{className:"container mx-auto p-4",children:[t.jsx(N,{as:"h1",className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(ce,{products:e,onProductUpdate:a,onProductAdd:n}),t.jsx(X,{coupons:s,onCouponAdd:o})]})]}),ie=({isAdmin:e,onToggleAdmin:s,title:a="쇼핑몰 관리 시스템"})=>t.jsx("nav",{className:"bg-blue-600 text-white p-4",children:t.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[t.jsx(N,{as:"h1",className:"text-2xl font-bold",children:a}),t.jsx(p,{onClick:s,children:e?"장바구니 페이지로":"관리자 페이지로"})]})}),ue=({children:e,isAdmin:s,onToggleAdmin:a})=>t.jsxs("div",{className:"min-h-screen bg-gray-100",children:[t.jsx(ie,{isAdmin:s,onToggleAdmin:a}),t.jsx("main",{className:"container mx-auto mt-6",children:e})]}),me=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],he=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],xe=()=>{const{products:e,updateProduct:s,addProduct:a}=J(me),{coupons:n,addCoupon:o}=Q(he),[d,r]=b.useState(!1),c=()=>{r(!d)};return t.jsx(ue,{isAdmin:d,onToggleAdmin:c,children:d?t.jsx(le,{products:e,coupons:n,onProductUpdate:s,onProductAdd:a,onCouponAdd:o}):t.jsx(W,{products:e,coupons:n})})};D.createRoot(document.getElementById("root")).render(t.jsx(A.StrictMode,{children:t.jsx(xe,{})}));

import{j as e,r as b,c as D,R as A}from"./client-DD4c7S6m.js";const N=({children:t,as:s="h2",className:a=""})=>{const n=s,o=`${a}`;return e.jsx(n,{className:o,children:t})},g=({onClick:t,children:s,variant:a="primary",disabled:n=!1,className:o="",type:d="button",dataTestId:c=""})=>{const r="px-4 py-2 rounded focus:outline-none transition-colors",u={primary:"bg-white text-blue-600 hover:bg-blue-100",secondary:"bg-blue-600 text-white hover:bg-blue-500",danger:"bg-red-500 text-white hover:bg-red-600",success:"bg-green-500 text-white hover:bg-green-600",default:""},l=n?"opacity-50 cursor-not-allowed":"",i=`${r} ${u[a]} ${l} ${o}`;return e.jsx("button",{"data-testid":c,type:d,onClick:t,className:i,disabled:n,children:s})},T=({item:t,appliedDiscount:s,onUpdateQuantity:a,onRemoveFromCart:n})=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,s>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(s*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(g,{onClick:()=>a(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1.5 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx(g,{onClick:()=>a(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1.5 mr-1 hover:bg-gray-400",children:"+"}),e.jsx(g,{onClick:()=>n(t.product.id),variant:"danger",className:"px-2 py-1.5",children:"삭제"})]})]}),w=(t,s)=>t.filter(a=>s>=a.quantity).reduce((a,n)=>Math.max(a,n.rate),0),F=(t,s)=>{const a=t.reduce((d,c)=>d+c.product.price*c.quantity,0);let n=t.reduce((d,c)=>{const r=w(c.product.discounts,c.quantity);return d+c.product.price*c.quantity*(1-r)},0);s&&(s.discountType==="amount"?n=Math.max(0,n-s.discountValue):n*=1-s.discountValue/100);const o=a-n;return{totalBeforeDiscount:Math.round(a),totalAfterDiscount:Math.round(n),totalDiscount:Math.round(o)}},q=(t,s,a)=>t.map(n=>{if(n.product.id===s){const o=Math.max(0,Math.min(a,n.product.stock));return o>0?{...n,quantity:o}:null}return n}).filter(n=>n!==null),I=t=>t.reduce((s,a)=>Math.max(s,a.rate),0),V=(t,s=[])=>{const a=s.find(n=>n.product.id===t.id);return t.stock-((a==null?void 0:a.quantity)||0)},$=t=>w(t.product.discounts,t.quantity),E=(t,s)=>t.find(n=>n.product.id===s.id)?t.map(n=>n.product.id===s.id?{...n,quantity:Math.min(n.quantity+1,s.stock)}:n):[...t,{product:s,quantity:1}],M=({cart:t,onUpdateQuantity:s,onRemoveFromCart:a})=>e.jsxs("div",{children:[e.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsx(T,{item:n,appliedDiscount:$(n),onUpdateQuantity:s,onRemoveFromCart:a},n.product.id))})]}),R=({coupons:t,selectedCoupon:s,onApplyCoupon:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"쿠폰 적용"}),e.jsxs("select",{onChange:n=>a(t[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((n,o)=>e.jsxs("option",{value:o,children:[n.name," -"," ",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`]},n.code))]}),s&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인)"]})]}),L=({totalBeforeDiscount:t,totalAfterDiscount:s,totalDiscount:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",t.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",a.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",s.toLocaleString(),"원"]})]})]}),U=({product:t,remainingStock:s,onAddToCart:a})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(I(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((n,o)=>e.jsxs("li",{children:[n.quantity,"개 이상: ",(n.rate*100).toFixed(0),"% 할인"]},o))}),e.jsx(g,{onClick:()=>a(t),variant:"secondary",className:`w-full px-3 py-1 ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]}),O=({products:t,cart:s,onAddToCart:a})=>e.jsxs("div",{children:[e.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(n=>e.jsx(U,{product:n,remainingStock:V(n,s),onAddToCart:a},n.id))})]}),B=()=>{const[t,s]=b.useState([]),[a,n]=b.useState(null);return{cart:t,addToCart:l=>{s(i=>E(i,l))},removeFromCart:l=>{s(i=>i.filter(x=>x.product.id!==l))},updateQuantity:(l,i)=>{s(x=>q(x,l,i))},applyCoupon:l=>{n(l)},calculateTotal:()=>F(t,a),selectedCoupon:a}};function P(t,s){const[a,n]=b.useState(()=>{try{const d=window.localStorage.getItem(t);return d?JSON.parse(d):s}catch{return s}});return[a,d=>{try{const c=d instanceof Function?d(a):d;n(c),window.localStorage.setItem(t,JSON.stringify(c))}catch(c){console.log(c)}}]}const Q=t=>{const[s,a]=P("coupons",t);return{coupons:s,addCoupon:o=>{a(d=>[...d,o])}}},J=t=>{const[s,a]=P("products",t);return{products:s,updateProduct:c=>{a(r=>r.map(u=>u.id===c.id?c:u))},addProduct:c=>{a(r=>[...r,c])},removeProduct:c=>{a(r=>r.filter(u=>u.id!==c))}}},W=({products:t,coupons:s})=>{const{cart:a,addToCart:n,removeFromCart:o,updateQuantity:d,applyCoupon:c,calculateTotal:r,selectedCoupon:u}=B(),{totalBeforeDiscount:l,totalAfterDiscount:i,totalDiscount:x}=r();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(N,{as:"h1",className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(O,{products:t,cart:a,onAddToCart:n}),e.jsxs("div",{children:[e.jsx(M,{cart:a,onUpdateQuantity:d,onRemoveFromCart:o}),e.jsx(R,{coupons:s,selectedCoupon:u,onApplyCoupon:c}),e.jsx(L,{totalBeforeDiscount:l,totalAfterDiscount:i,totalDiscount:x})]})]})]})};function H({onAddCoupon:t}){const[s,a]=b.useState({name:"",code:"",discountType:"percentage",discountValue:0}),n=l=>{a(i=>({...i,name:l}))},o=l=>{a(i=>({...i,code:l}))},d=l=>{a(i=>({...i,discountType:l}))},c=l=>{const i=parseInt(l)||0;a(x=>({...x,discountValue:i}))},r=()=>{u()&&(t(s),a({name:"",code:"",discountType:"percentage",discountValue:0}))},u=()=>{let l=!0;return s.name.trim()||(l=!1),s.code.trim()||(l=!1),s.discountValue<=0&&(l=!1),l};return{newCoupon:s,handleNameChange:n,handleCodeChange:o,handleDiscountTypeChange:d,handleDiscountValueChange:c,handleAddCoupon:r}}const _=({onAddCoupon:t})=>{const{newCoupon:s,handleNameChange:a,handleCodeChange:n,handleDiscountTypeChange:o,handleDiscountValueChange:d,handleAddCoupon:c}=H({onAddCoupon:t});return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:s.name,onChange:r=>a(r.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:s.code,onChange:r=>n(r.target.value),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.discountType,onChange:r=>o(r.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:s.discountValue,onChange:r=>d(r.target.value),className:"w-full p-2 border rounded"})]}),e.jsx(g,{onClick:c,variant:"success",className:"w-full",children:"쿠폰 추가"})]})},z=({coupon:t,index:s})=>e.jsxs("div",{"data-testid":`coupon-${s+1}`,className:"bg-gray-100 p-2 rounded",children:[t.name," (",t.code,"):",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," ","할인"]}),G=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((s,a)=>e.jsx(z,{coupon:s,index:a},s.code))})]}),K=({coupons:t,onCouponAdd:s})=>e.jsxs("div",{children:[e.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(_,{onAddCoupon:s}),e.jsx(G,{coupons:t})]})]}),X=({newProduct:t,onProductChange:s,onAddProduct:a})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:n=>s({...t,name:n.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:n=>s({...t,price:parseInt(n.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:n=>s({...t,stock:parseInt(n.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx(g,{onClick:a,variant:"secondary",className:"w-full",children:"추가"})]}),Y=({discount:t,index:s,onRemove:a,isEditing:n=!1})=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[t.quantity,"개 이상 구매 시 ",t.rate*100,"% 할인"]}),n&&a&&e.jsx(g,{onClick:()=>a(s),variant:"default",className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]}),S=({discounts:t,onRemoveDiscount:s,isEditing:a=!1})=>e.jsx(e.Fragment,{children:t.map((n,o)=>e.jsx(Y,{discount:n,index:o,onRemove:s,isEditing:a},o))}),Z=({newDiscount:t,onDiscountChange:s,onAddDiscount:a})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:t.quantity,onChange:n=>s({...t,quantity:parseInt(n.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:t.rate*100,onChange:n=>s({...t,rate:parseInt(n.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx(g,{onClick:a,variant:"default",className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]}),ee=({product:t,editingProduct:s,newDiscount:a,onProductNameUpdate:n,onPriceUpdate:o,onStockUpdate:d,onDiscountChange:c,onAddDiscount:r,onRemoveDiscount:u,onEditComplete:l})=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:s.name,onChange:i=>n(t.id,i.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:s.price,onChange:i=>o(t.id,parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:s.stock,onChange:i=>d(t.id,parseInt(i.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),e.jsx(S,{discounts:s.discounts,onRemoveDiscount:i=>u(t.id,i),isEditing:!0}),e.jsx(Z,{newDiscount:a,onDiscountChange:c,onAddDiscount:()=>r(t.id)})]}),e.jsx(g,{onClick:l,variant:"default",className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}),te=({product:t,index:s,isOpen:a,editingProduct:n,newDiscount:o,onToggle:d,onEdit:c,onProductNameUpdate:r,onPriceUpdate:u,onStockUpdate:l,onDiscountChange:i,onAddDiscount:x,onRemoveDiscount:v,onEditComplete:f})=>e.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs(g,{dataTestId:"toggle-button",onClick:()=>d(t.id),variant:"default",className:"w-full text-left font-semibold px-0",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),a&&e.jsx("div",{className:"mt-2",children:n&&n.id===t.id?e.jsx(ee,{product:t,editingProduct:n,newDiscount:o,onProductNameUpdate:r,onPriceUpdate:u,onStockUpdate:l,onDiscountChange:i,onAddDiscount:x,onRemoveDiscount:v,onEditComplete:f}):e.jsxs("div",{children:[e.jsx(S,{discounts:t.discounts}),e.jsx(g,{dataTestId:"modify-button",onClick:()=>c(t),variant:"default",className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]}),se=({products:t,openProductIds:s,editingProduct:a,newDiscount:n,onToggleProduct:o,onEditProduct:d,onProductNameUpdate:c,onPriceUpdate:r,onStockUpdate:u,onDiscountChange:l,onAddDiscount:i,onRemoveDiscount:x,onEditComplete:v})=>e.jsx("div",{className:"space-y-2",children:t.map((f,y)=>e.jsx(te,{product:f,index:y,isOpen:s.has(f.id),editingProduct:a,newDiscount:n,onToggle:o,onEdit:d,onProductNameUpdate:c,onPriceUpdate:r,onStockUpdate:u,onDiscountChange:l,onAddDiscount:i,onRemoveDiscount:x,onEditComplete:v},f.id))});function ne({onProductAdd:t}){const[s,a]=b.useState({name:"",price:0,stock:0,discounts:[]}),[n,o]=b.useState(!1),d=()=>{o(!n)},c=()=>{if(!r())return;const u={...s,id:Date.now().toString()};return t(u),a({name:"",price:0,stock:0,discounts:[]}),o(!1),u},r=()=>{let u=!0;return s.name.trim()||(u=!1),s.price<=0&&(u=!1),s.stock<=0&&(u=!1),u};return{newProduct:s,setNewProduct:a,showNewProductForm:n,toggleNewProductForm:d,handleAddNewProduct:c}}function ae({products:t,onProductUpdate:s}){const[a,n]=b.useState(new Set),[o,d]=b.useState(null),[c,r]=b.useState({quantity:0,rate:0});return{openProductIds:a,editingProduct:o,newDiscount:c,setNewDiscount:r,toggleProductAccordion:m=>{n(h=>{const p=new Set(h);return p.has(m)?p.delete(m):p.add(m),p})},handleEditProduct:m=>{d({...m})},handleProductNameUpdate:(m,h)=>{o&&o.id===m&&d({...o,name:h})},handlePriceUpdate:(m,h)=>{o&&o.id===m&&d({...o,price:h})},handleStockUpdate:(m,h)=>{const p=t.find(j=>j.id===m);if(p){const j={...p,stock:h};s(j),d(j)}},handleAddDiscount:m=>{if(o&&o.id===m){const h={...o,discounts:[...o.discounts,c]};s(h),d(h),r({quantity:0,rate:0})}},handleRemoveDiscount:(m,h)=>{const p=t.find(j=>j.id===m);if(p){const j={...p,discounts:p.discounts.filter((me,k)=>k!==h)};s(j),d(j)}},handleEditComplete:()=>{o&&(s(o),d(null))}}}const oe=({products:t,onProductUpdate:s,onProductAdd:a})=>{const{newProduct:n,setNewProduct:o,showNewProductForm:d,toggleNewProductForm:c,handleAddNewProduct:r}=ne({onProductAdd:a}),{openProductIds:u,editingProduct:l,newDiscount:i,setNewDiscount:x,toggleProductAccordion:v,handleEditProduct:f,handleProductNameUpdate:y,handlePriceUpdate:C,handleStockUpdate:m,handleAddDiscount:h,handleRemoveDiscount:p,handleEditComplete:j}=ae({products:t,onProductUpdate:s});return e.jsxs("div",{children:[e.jsx(N,{as:"h2",className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(g,{onClick:c,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:d?"취소":"새 상품 추가"}),d&&e.jsx(X,{newProduct:n,onProductChange:o,onAddProduct:r}),e.jsx(se,{products:t,openProductIds:u,editingProduct:l,newDiscount:i,onToggleProduct:v,onEditProduct:f,onProductNameUpdate:y,onPriceUpdate:C,onStockUpdate:m,onDiscountChange:x,onAddDiscount:h,onRemoveDiscount:p,onEditComplete:j})]})},de=({products:t,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:o})=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(N,{as:"h1",className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(oe,{products:t,onProductUpdate:a,onProductAdd:n}),e.jsx(K,{coupons:s,onCouponAdd:o})]})]}),ce=({isAdmin:t,onToggleAdmin:s,title:a="쇼핑몰 관리 시스템"})=>e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx(N,{as:"h1",className:"text-2xl font-bold",children:a}),e.jsx(g,{onClick:s,children:t?"장바구니 페이지로":"관리자 페이지로"})]})}),re=({children:t,isAdmin:s,onToggleAdmin:a})=>e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx(ce,{isAdmin:s,onToggleAdmin:a}),e.jsx("main",{className:"container mx-auto mt-6",children:t})]}),le=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],ie=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ue=()=>{const{products:t,updateProduct:s,addProduct:a}=J(le),{coupons:n,addCoupon:o}=Q(ie),[d,c]=b.useState(!1),r=()=>{c(!d)};return e.jsx(re,{isAdmin:d,onToggleAdmin:r,children:d?e.jsx(de,{products:t,coupons:n,onProductUpdate:s,onProductAdd:a,onCouponAdd:o}):e.jsx(W,{products:t,coupons:n})})};D.createRoot(document.getElementById("root")).render(e.jsx(A.StrictMode,{children:e.jsx(ue,{})}));
